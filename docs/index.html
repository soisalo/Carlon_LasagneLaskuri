<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lasagne Laskuri</title>
    <style>
         body {
            font-family: 'Lucida Console', 'Courier New'; 
            background-image: url("https://github.com/soisalo/Carlon_LasagneLaskuri/raw/main/docs/photo_5816802530166948329_y.jpg");
            background-size: cover; 
            background-attachment: fixed; 
        }

        h1 {
            font-family: 'Georgia', serif; /* Change the font for h1 elements */
        }

        /* Additional styles for specific elements */
        #results p {
            font-family: 'Courier New', monospace; /* Change the font for p elements within the #results div */
        }
    </style>
</head>
<body>
    
    <h1>Carlon Lasagne-Laskuri</h1>
    
    <div id="results">
        <h2>Tulokset</h2>
        <h4>Carlo on syönyt 2.5 lasagnea</h4> 
        <h4>Carlo on syönyt 2500 grammaa lasagnea</h4>
        <h4>Carlo on saanut 3300 kCal lasagnesta</h4>
        <h4>Carlo on käyttänyt 11.05 euroa lasagneen.</h4>
        <p id="lasagne-portions"></p>
        <p id="total-grams"></p>
        <p id="total-calories"></p>
        <p id="total-price"></p>
    </div>

    <script>
        const username = 'soisalo';  // replace with your GitHub username
        const repo = 'Carlon_LasagneLaskin';  // replace with your repository name
        const path = 'docs/lasagne.txt';  // the path to your file in the repository
        const token = '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';  // your GitHub personal access token

        async function fetchFileContent() {
            const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
            try {
                const response = await fetch(url, {
                    headers: {
                        'Accept': 'application/vnd.github.v3.raw'
                    }
                });
                if (response.ok) {
                    return await response.text();
                } else {
                    console.error('Error reading file:', response.statusText);
                }
            } catch (error) {
                console.error('Error fetching file:', error);
            }
        }

        async function updateFileContent(content) {
            const getShaUrl = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
            const getShaResponse = await fetch(getShaUrl, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            if (!getShaResponse.ok) {
                console.error('Error getting file SHA:', getShaResponse.statusText);
                return;
            }

            const fileData = await getShaResponse.json();
            const sha = fileData.sha;

            const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
            const body = {
                message: 'Update lasagne.txt',
                content: btoa(content),
                sha: sha
            };

            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    console.log('File updated successfully');
                } else {
                    console.error('Error updating file:', response.statusText);
                }
            } catch (error) {
                console.error('Error updating file:', error);
            }
        }

        function parseFileContent(content) {
            const lines = content.split('\n');
            const data = {};
            lines.forEach(line => {
                const [key, value] = line.split(': ');
                if (key && value) {
                    data[key] = value;
                }
            });
            return data;
        }

        async function addLasagnePortion() {
            const additionalPortions = parseInt(document.getElementById('additional-portions').value);
            const fileContent = await fetchFileContent();
            if (fileContent) {
                const data = parseFileContent(fileContent);
                data.lasagne_portions = parseInt(data.lasagne_portions) + additionalPortions;
                data.total_grams = data.lasagne_portions * data.grams_per_portion;
                data.total_calories = data.lasagne_portions * data.calories_per_portion;
                data.total_price = data.lasagne_portions * data.price_per_portion;

                const newContent = `lasagne_portions: ${data.lasagne_portions}\ngrams_per_portion: ${data.grams_per_portion}\ncalories_per_portion: ${data.calories_per_portion}\nprice_per_portion: ${data.price_per_portion}`;
                await updateFileContent(newContent);

                document.getElementById('lasagne-portions').innerText = `Carlo on syönyt ${data.lasagne_portions} lasagne-annosta.`;
                document.getElementById('total-grams').innerText = `Carlo on syönyt ${data.total_grams} grammaa lasagnea.`;
                document.getElementById('total-calories').innerText = `Carlo on saanut ${data.total_calories} kcal lasagnesta.`;
                document.getElementById('total-price').innerText = `Carlon lasagne-annosten hinta on ${data.total_price} euroa.`;
            }
        }

        window.onload = async () => {
            const fileContent = await fetchFileContent();
            if (fileContent) {
                const data = parseFileContent(fileContent);
                document.getElementById('lasagne-portions').innerText = `Carlo on syönyt ${data.lasagne_portions} lasagne-annosta.`;
                document.getElementById('total-grams').innerText = `Carlo on syönyt ${data.lasagne_portions * data.grams_per_portion} grammaa lasagnea.`;
                document.getElementById('total-calories').innerText = `Carlo on saanut ${data.lasagne_portions * data.calories_per_portion} kcal lasagnesta.`;
                document.getElementById('total-price').innerText = `Carlon lasagne-annosten hinta on ${data.lasagne_portions * data.price_per_portion} euroa.`;
            }
        };
    </script>
</body>
</html>
